# IdentityV 参加型メンバー自動調整（第5人格）

配信の参加型向けに、**サバ4＋ハン1**の編成を自動で決め、全員の出場回数が平均になるように調整するシンプルなWebアプリです。
新規参加者の初回優先・手動修正・削除／一括削除・**2試合同時**（アクティブ10人以上）に対応。

---

## 1. 使い方

1. ページを開く
2. 上部のフォームから**名前**を入力 → 〔追加〕
3. 参加者の**希望ロール**（サバ／ハン／希望なし）を必要に応じて設定
4. 〔自動選定（確定）〕を押すと、**サバ4＋ハン1**が決まって履歴に保存
5. 次の試合も同様にボタンを押すだけ（平均に近づくよう自動調整）

---

## 2. 主な機能

* **自動選定**：総出場回数の平均化を目標にランダム調整

  * 新規参加者は**初回まで優先**（来たばかりでもすぐ回りやすい）
  * ロール希望（サバ／ハン）も反映
* **2試合同時モード**：チェックONで**同時に2試合分**のメンバーを被りなしで確定

  * 有効化条件：**アクティブ10人以上**
* **手動修正モード**：オンにすると

  * 名前変更、希望変更、**サバ／ハン回数の手動±**（調整値として保存）
  * **手動で試合を登録**（ハン1＋サバ4を選んで追加）
* **削除**：個別削除／**選択したメンバーを一括削除**（履歴からも関連試合を削除して再計算）
* **CSVエクスポート**：現在の名簿をCSVでバックアップ
* **ライト／ダーク切替**：Auto（OS追従）→ Light → Dark を切替可能
* **データは端末に保存**：ブラウザの`localStorage`（キー: `iv_players`, `iv_matches`）

---

## 3. 画面の見方とボタン

* 〔**自動選定（確定）**〕… 次の試合メンバーを決定し、履歴に保存
* 〔**直前の試合を取り消し**〕… 直前に確定した試合（2試合同時の場合は直近2件）を取り消し
* **2試合同時**（チェック）… ONで2試合分を一括確定（アクティブ10人以上）
* **手動修正**（チェック）… オンにするとテーブルで

  * 名前編集、希望変更、サバ／ハンの「＋／−」ボタンが表示
  * 下部フォームから**手動で試合追加**も可能
* **参加者一覧**

  * 左端のチェックで選択 → 〔**選択を一括削除**〕
  * 各行のチェック（✓）で**アクティブ**切替（抽選対象／対象外）
* **直近の試合**… 最新の確定メンバーを表示（2試合同時は2枠表示）
* **ライト／ダーク**… ヘッダー右上と下部ドックのボタンで切替（Auto→Light→Dark）

---

## 4. よくある操作フロー（例）

1. 配信開始時に常連と新規をどんどん〔追加〕
2. 参加者が5人以上になったら〔自動選定（確定）〕
3. 10人以上なら**2試合同時**にチェック → 一気に回す
4. 調整が必要なら「手動修正」をONにして**回数±**や**希望変更**
5. 抜けた人は**アクティブOFF**か**削除**
6. 配信終了時に〔CSVエクスポート〕でバックアップ（任意）

---

## 5. データの扱い（消えない？）

* **消えません**：同じドメイン・同じブラウザなら、ページ更新やコード差し替えをしても`localStorage`のデータは保持されます。
* **消える可能性**：ユーザーが閲覧データを削除／シークレットモード／別ブラウザ・別端末／ドメイン変更 など。
* 安心運用：**CSVエクスポート**でバックアップをおすすめ。
